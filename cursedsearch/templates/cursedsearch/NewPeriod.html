{% extends "global/Page.html" %}
{% load staticfiles otree %}

{% block title %}
    New Period
{% endblock %}



{% block content %}
     <p>
         This is period {{subsession.period}} of market session {{subsession.market_number}}. Your type is {{player.type}} .
     </p>

    {% if player.wait == 0 %}
    <p>
        You are currently in the market. In the next screen you will receive information about a potential partner.
    </p>
    {% elif player.wait == 1 %}
    <p>
        You are currently on hold. You are the first in the waiting list.
    </p>
    {% elif player.wait == 2 %}
    <p>
        You are currently on hold. You are the second in the waiting list.
    </p>
    {% elif player.wait == 3 %}
    <p>
        You are currently on hold. You are the third in the waiting list.
    </p>
    {% endif %}

    {% next_button %}

    <h4>History of this market session</h4>
    <table class="table">
        <tr>
            <th>Period</th>
            <th>Status</th>
            <th>Observed clue</th>
            <th>Did you propose?</th>
            <th>Successful match?</th>
            <th>Match payoff</th>
        </tr>
        {% for p in player.in_current_market %}
            <tr>
                <td>{{ p.subsession.period }}</td>
                <td>{% if p.wait == 0 %} In market {% elif p.wait == 1 %} First in waiting list {% elif p.wait == 2 %} Second in waiting list {% elif p.wait == 3 %} Third in waiting list {% endif %}  </td>
                <td> {% if p.wait > 0 or p.round_number == player.round_number %} - {% else %} {{p.signal}} {% endif %}</td>
                <td> {% if p.wait > 0 or p.round_number == player.round_number %} - {% elif p.choice == 1%} Yes {% elif p.choice == 0%} No {% endif %}</td>
                <td> {% if p.wait > 0 or p.round_number == player.round_number %} - {% elif p.match == 0 %} No {% elif p.match == 1 %} Yes {% endif %}</td>
                <td> {% if p.wait > 0 or p.round_number == player.round_number or p.match == 0 %} - {% else %} {{p.payoff}} {% endif %}</td>
            </tr>
        {% endfor %}
    </table>

{% endblock %}

{% block styles %}
    <style>
        .otree-timer {
            display: none;
        }
    </style>
{% endblock %}

{% block scripts %}
    <script>
        $(function () {
            $('.otree-timer__time-left').on('update.countdown', function (event) {
                if (event.offset.totalSeconds === 10) {
                    $('.otree-timer').show();
                }
            });
        });
    </script>
{% endblock %}